# 自定义角色功能说明

## 功能概述

已成功实现自定义角色功能，用户可以通过Web界面创建自己的AI角色。

## 功能特点

### 1. 用户界面
- 在主页面添加了"自定义角色"按钮
- 创建了专门的自定义角色页面，包含完整的表单界面
- 响应式设计，支持移动端和桌面端

### 2. 表单字段
- **角色ID** (必填): 英文字母、数字或下划线，实时验证
- **角色名** (必填): 角色的显示名称
- **角色英文名** (可选): 角色的英文名称
- **主题颜色** (必填): 支持颜色选择器和手动输入十六进制颜色
- **角色立绘校准** (必填): -100到100的整数，调整立绘位置
- **角色简介** (必填): 较大的文本框，用于角色介绍
- **角色描述** (必填): 角色的基本设定和说话风格
- **角色心情设置** (必填): 动态表格，支持添加/删除心情
  - 心情名称 (必填)
  - 角色立绘图片 (必填)
  - 参考音频 (可选)
- **角色详细信息** (必填): 支持上传多个.txt文件

### 3. 交互功能
- 实时表单验证
- 颜色选择器与文本输入同步
- 动态添加/删除心情行
- 文件上传预览
- 草稿保存/加载功能
- 加载指示器

### 4. 后端处理
- 创建角色目录结构
- 保存上传的图片和音频文件
- 生成角色配置Python文件
- 完整的数据验证

## 文件结构

```
├── templates/index.html          # 主页面，包含自定义角色页面
├── static/css/style.css          # 样式文件，包含自定义角色样式
├── static/js/custom_character.js # 自定义角色JavaScript逻辑
├── test_custom_character.html    # 独立测试页面
└── app.py                        # 后端API路由
```

## 使用方法

### 1. 访问功能
- 启动应用后，在主页面点击"自定义角色"按钮
- 或直接访问测试页面 `test_custom_character.html`

### 2. 填写表单
1. 输入角色ID（只能包含英文字母、数字、下划线）
2. 填写角色名称和描述信息
3. 选择主题颜色
4. 设置立绘校准值
5. 添加至少一个心情设置（包含心情名称和立绘图片）
6. 上传角色详细信息文件（.txt格式）

### 3. 提交或保存
- 点击"完成"提交创建角色
- 点击"存草稿"保存当前进度
- 点击"取消"返回主页

## 技术实现

### 前端
- 使用原生JavaScript实现交互逻辑
- CSS Grid布局实现响应式表格
- FormData API处理文件上传
- localStorage实现草稿功能

### 后端
- Flask路由处理API请求
- 文件上传和保存处理
- 数据验证和错误处理
- 动态生成角色配置文件

## 注意事项

1. 角色ID必须唯一，建议使用有意义的英文标识符
2. 图片文件建议使用常见格式（jpg, png, gif等）
3. 音频文件支持常见格式（mp3, wav, ogg等）
4. 详细信息文件必须是UTF-8编码的.txt文件
5. 表单数据会在提交成功后清除草稿

## 扩展建议

1. 添加角色预览功能
2. 支持更多文件格式
3. 添加角色编辑功能
4. 实现角色导入/导出
5. 添加角色模板功能