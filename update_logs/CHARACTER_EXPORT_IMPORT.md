# 角色导出导入功能使用说明

## 功能概述

在自定义角色页面新增了"导出角色"和"导入角色"功能，允许用户将角色配置和相关文件打包导出，或从zip文件导入角色。

## 使用方法

### 导出角色

1. 在自定义角色页面点击"导出角色"按钮
2. 在弹出的对话框中输入要导出的角色ID
3. 点击"导出"按钮
4. 系统会自动下载一个zip文件，包含角色的所有相关文件

### 导入角色

1. 在自定义角色页面点击"导入角色"按钮
2. 在弹出的对话框中选择要导入的zip文件
3. 点击"导入"按钮
4. 系统会自动解压并安装角色到相应目录

## 导出文件结构

导出的zip文件包含以下目录结构：

```
角色ID.zip
├── characters/
│   └── 角色ID.toml (或 .py)
├── data/
│   ├── details/
│   │   └── 角色ID.json
│   └── ref_audio/
│       └── 角色ID/
│           ├── 1.wav
│           ├── 1.txt
│           └── ...
└── static/
    └── images/
        └── 角色ID/
            ├── avatar.png
            ├── 1.png
            ├── 2.png
            └── ...
```

## 注意事项

1. **角色ID格式**：只能包含英文字母、数字或下划线
2. **文件冲突**：导入时如果角色ID已存在，会提示先删除现有角色
3. **文件格式**：只支持zip格式的导入文件
4. **重启程序**：导入完成后建议重启程序以确保角色正确加载

## 技术实现

### 前端
- 使用模态框提供用户界面
- 支持文件下载和上传
- 包含完整的错误处理和用户反馈

### 后端
- 使用Python的zipfile模块进行文件打包和解压
- 支持TOML和Python两种角色配置格式
- 自动创建必要的目录结构
- 完整的文件验证和错误处理

## API端点

- `GET /api/export-character/<character_id>` - 导出角色
- `POST /api/import-character` - 导入角色

## 测试

可以使用提供的测试脚本验证功能：

```bash
python test_export_import.py
```

确保服务器正在运行在 http://localhost:5000
