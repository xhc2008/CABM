# Docker é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ“ é—®é¢˜æ€»ç»“

ç»è¿‡ä¸ºCABMé¡¹ç›®æ­å»ºDockerç¯å¢ƒï¼Œæˆ‘å·²ç»å®Œæˆäº†ä»¥ä¸‹å·¥ä½œï¼š

### âœ… å·²å®Œæˆçš„é…ç½®

1. **æ ¸å¿ƒæ–‡ä»¶åˆ›å»º**
   - `Dockerfile` - æ”¯æŒå¤šæ¶æ„çš„é•œåƒæ„å»ºæ–‡ä»¶
   - `docker-compose.yml` - å®Œæ•´çš„æœåŠ¡ç¼–æ’é…ç½®
   - `.env.docker` - ç¯å¢ƒå˜é‡æ¨¡æ¿
   - `.dockerignore` - æ„å»ºä¼˜åŒ–é…ç½®

2. **ç®¡ç†è„šæœ¬**
   - `docker-start.sh` - ä¸»ç®¡ç†è„šæœ¬ï¼ˆå¯åŠ¨ã€åœæ­¢ã€é‡å¯ç­‰ï¼‰
   - `deploy.sh` - ä¸€é”®éƒ¨ç½²è„šæœ¬
   - `test-docker.sh` - æœ¬åœ°å¼€å‘æµ‹è¯•è„šæœ¬
   - `build-local.sh` - æœ¬åœ°å•æ¶æ„æ„å»ºè„šæœ¬
   - `release.sh` - é•œåƒå‘å¸ƒè„šæœ¬ï¼ˆå·²ä¿®å¤å¤šæ¶æ„é—®é¢˜ï¼‰

3. **CI/CDé…ç½®**
   - `.github/workflows/docker.yml` - GitHub Actionsè‡ªåŠ¨æ„å»º

4. **æ–‡æ¡£**
   - `DOCKER.md` - Dockeréƒ¨ç½²æŒ‡å—
   - `DOCKER_COMPLETE.md` - å®Œæ•´ä½¿ç”¨æ–‡æ¡£

### ğŸ”§ é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. å¤šæ¶æ„æ„å»ºé—®é¢˜
**é—®é¢˜**: `--load` å‚æ•°ä¸æ”¯æŒå¤šæ¶æ„é•œåƒå¯¼å‡º
**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹äº† `release.sh` è„šæœ¬ï¼Œåˆ†ç¦»æœ¬åœ°æ„å»ºå’Œå¤šæ¶æ„æ¨é€

#### 2. ç½‘ç»œä¸‹è½½æ…¢é—®é¢˜
**é—®é¢˜**: PythonåŸºç¡€é•œåƒä¸‹è½½ç¼“æ…¢
**è§£å†³æ–¹æ¡ˆ**: 
- æä¾›äº† `build-local.sh` è„šæœ¬ç”¨äºæœ¬åœ°å¼€å‘
- å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæº
- å»ºè®®ä½¿ç”¨é¢„æ„å»ºé•œåƒ

## ğŸš€ å¿«é€Ÿå¼€å§‹æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨æœ¬åœ°æ„å»ºè„šæœ¬ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

```bash
# æ„å»ºæœ¬åœ°é•œåƒï¼ˆå•æ¶æ„ï¼Œé€Ÿåº¦æ›´å¿«ï¼‰
./build-local.sh v1.0.0 build

# æµ‹è¯•é•œåƒ
./build-local.sh v1.0.0 test

# è¿è¡Œå®¹å™¨
./build-local.sh v1.0.0 run
```

### æ–¹æ¡ˆ2ï¼šç›´æ¥ä½¿ç”¨Docker Compose

```bash
# é…ç½®ç¯å¢ƒå˜é‡
cp .env.docker .env.docker
# ç¼–è¾‘ .env.dockerï¼Œå¡«å…¥APIå¯†é’¥

# ä½¿ç”¨docker-composeå¿«é€Ÿå¯åŠ¨
./docker-start.sh start
```

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨é¢„æ„å»ºé•œåƒï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰

```bash
# ç­‰å¾…GitHub Actionsæ„å»ºå®Œæˆå
docker pull ghcr.io/xhc2008/cabm:latest

# ä½¿ç”¨é¢„æ„å»ºé•œåƒå¯åŠ¨
docker-compose up -d
```

## ğŸ³ å›½å†…ç½‘ç»œä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨å›½å†…Dockeré•œåƒæº

ç¼–è¾‘ `/etc/docker/daemon.json`:
```json
{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://hub-mirror.c.163.com",
    "https://mirror.baidubce.com"
  ]
}
```

é‡å¯Docker:
```bash
sudo systemctl restart docker
```

### 2. ä¿®æ”¹Dockerfileä½¿ç”¨å›½å†…æº

å¯ä»¥ä¿®æ”¹Dockerfileï¼Œä½¿ç”¨å›½å†…Pythonæºï¼š

```dockerfile
# åœ¨RUN pip installå‰æ·»åŠ 
RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple/
```

### 3. é¢„ä¸‹è½½åŸºç¡€é•œåƒ

```bash
# æå‰ä¸‹è½½PythonåŸºç¡€é•œåƒ
docker pull python:3.11-slim
```

## ğŸ“Š æµ‹è¯•ç»“æœ

å½“å‰çŠ¶æ€ï¼š
- âœ… æ‰€æœ‰è„šæœ¬å·²åˆ›å»ºå¹¶è®¾ç½®æ‰§è¡Œæƒé™
- âœ… Dockerfileé…ç½®å®Œæˆï¼Œæ”¯æŒå¤šæ¶æ„
- âœ… docker-composeé…ç½®å®Œæˆ
- âœ… å¤šæ¶æ„æ„å»ºé—®é¢˜å·²ä¿®å¤
- âœ… æœ¬åœ°æ„å»ºè„šæœ¬å·²ä¼˜åŒ–
- â³ ç½‘ç»œä¸‹è½½é€Ÿåº¦ä¾èµ–ç½‘ç»œç¯å¢ƒ

## ğŸ”„ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯ç”¨çš„æ–¹æ¡ˆï¼š

1. **æœ¬åœ°å¼€å‘**
   ```bash
   ./build-local.sh latest build
   ```

2. **å¿«é€Ÿéƒ¨ç½²**
   ```bash
   # é…ç½®APIå¯†é’¥å
   ./deploy.sh
   ```

3. **ç”Ÿäº§å‘å¸ƒ**
   ```bash
   # æ¨é€åˆ°GitHubåè‡ªåŠ¨æ„å»º
   git push origin main
   ```

### é•œåƒä»“åº“å‡†å¤‡

è„šæœ¬å·²é…ç½®æ”¯æŒå¤šä¸ªé•œåƒä»“åº“ï¼š
- GitHub Container Registry: `ghcr.io/xhc2008/cabm`
- Docker Hub: `docker.io/xhc2008/cabm`
- é˜¿é‡Œäº‘: `registry.cn-hangzhou.aliyuncs.com/xhc2008/cabm`

## ğŸ¯ æ¨èä½¿ç”¨æµç¨‹

### å¼€å‘é˜¶æ®µï¼š
```bash
./build-local.sh dev build   # æ„å»ºå¼€å‘ç‰ˆæœ¬
./build-local.sh dev test    # æµ‹è¯•åŠŸèƒ½
./build-local.sh dev run     # è¿è¡Œè°ƒè¯•
```

### æµ‹è¯•é˜¶æ®µï¼š
```bash
./test-docker.sh test        # å®Œæ•´æµ‹è¯•æµç¨‹
```

### å‘å¸ƒé˜¶æ®µï¼š
```bash
./release.sh v1.0.0          # å‘å¸ƒæ­£å¼ç‰ˆæœ¬
```

## ğŸ“š å®Œæ•´æ–‡æ¡£

- **å¿«é€Ÿå…¥é—¨**: æŸ¥çœ‹ `DOCKER.md`
- **å®Œæ•´æŒ‡å—**: æŸ¥çœ‹ `DOCKER_COMPLETE.md`
- **è„šæœ¬å¸®åŠ©**: è¿è¡Œä»»æ„è„šæœ¬ååŠ  `help` å‚æ•°

æ‰€æœ‰è„šæœ¬éƒ½åŒ…å«è¯¦ç»†çš„å¸®åŠ©ä¿¡æ¯å’Œé”™è¯¯å¤„ç†ï¼Œç¡®ä¿ç”¨æˆ·å‹å¥½çš„ä½“éªŒï¼

---

**DockeråŒ–å·¥ä½œå·²å®Œæˆï¼Œç°åœ¨å¯ä»¥äº«å—å®¹å™¨åŒ–éƒ¨ç½²çš„ä¾¿åˆ©ï¼** ğŸ³
