<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CABM - 资源管理</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/sci-fi-theme.css">
    <link rel="stylesheet" href="/static/css/media.css">
    <link rel="stylesheet" href="/static/css/resource-management.css">
</head>

<body>
    <div class="container">
        <div id="resourceManagementPage" class="page active">
            <div class="home-background"></div>
            <div class="chat-header" style="background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));">
                <a href="/" class="btn back-btn">首页</a>
                <h2>资源管理</h2>
            </div>

            <div style="padding: 50px 40px 40px;">
                <!-- 选项卡 -->
                <div class="resource-tabs">
                    <button class="resource-tab active" data-tab="characters">角色</button>
                    <button class="resource-tab" data-tab="backgrounds">背景</button>
                    <button class="resource-tab" data-tab="music">音乐</button>
                </div>

                <!-- 角色管理 -->
                <div id="characters-tab" class="tab-content active">
                    <div class="character-actions">
                        <button id="createCharacterBtn" class="btn sci-fi-btn primary">创建角色</button>
                        <button id="importCharacterBtn" class="btn sci-fi-btn secondary">导入角色</button>
                        <input type="file" id="hiddenCharacterFileInput" style="display: none;" accept=".zip">
                    </div>

                    <div id="charactersList" class="character-list">
                        <!-- 角色列表将通过JavaScript动态加载 -->
                    </div>
                </div>

                <!-- 背景管理 -->
                <div id="backgrounds-tab" class="tab-content">
                    <div class="character-actions">
                        <button id="addBackgroundBtn" class="btn sci-fi-btn primary">添加背景</button>
                        <button id="refreshBackgroundsBtn" class="btn sci-fi-btn secondary">刷新列表</button>
                        <input type="file" id="hiddenBackgroundFileInput" style="display: none;"
                            accept=".jpg,.jpeg,.png,.gif,.webp">
                    </div>

                    <div id="backgroundsList" class="backgrounds-grid">
                        <!-- 背景列表将通过JavaScript动态加载 -->

                    </div>
                </div>

                <!-- 音乐管理 -->
                <div id="music-tab" class="tab-content">
                    <div class="character-actions">
                        <button id="addMusicBtn" class="btn sci-fi-btn primary">添加音乐</button>
                        <button id="refreshMusicBtn" class="btn sci-fi-btn secondary">刷新列表</button>
                        <input type="file" id="hiddenMusicFileInput" style="display: none;"
                            accept=".mp3,.wav,.aac,.ogg,.m4a,.flac">
                    </div>

                    <div id="musicList" class="music-list">
                        <!-- 音乐列表将通过JavaScript动态加载 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 角色详情模态框 -->
    <div id="characterDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>角色详情</h3>
                <button class="close-btn" onclick="closeCharacterDetail()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="character-detail">
                    <img id="detailAvatar" class="character-avatar" src="" alt="角色头像">
                    <div class="character-profile">
                        <div class="profile-item">
                            <div class="profile-label">角色名称</div>
                            <div id="detailName" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">角色ID</div>
                            <div id="detailId" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">英文名</div>
                            <div id="detailEnglishName" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">角色简介</div>
                            <div id="detailDescription" class="profile-value"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="exportCharacterBtn" class="btn sci-fi-btn secondary">导出</button>
                    <button id="deleteCharacterBtn" class="btn sci-fi-btn danger-btn">删除</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header danger-header">
                <h3>危险操作确认</h3>
                <button class="close-btn" onclick="closeDeleteConfirm()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <p>即将执行<strong class="danger-text">不可恢复的删除操作</strong>！</p>
                    <p>此操作将<strong class="danger-text">永久删除（真的很久！）</strong>：</p>
                </div>
                <div class="delete-target-info">
                    <p><strong id="deleteCharacterName"></strong> (ID: <strong id="deleteCharacterId"></strong>)</p>
                </div>
                <div class="confirmation-step">
                    <p>请输入角色ID<strong id="confirmCharacterId"></strong>以确认删除：</p>
                    <input type="text" id="confirmDeleteInput" class="sci-fi-input confirm-input danger-input"
                        placeholder="请输入上方显示的角色ID">
                    <div class="warning-hint">
                        <span>⚠️ 此操作无法撤销，请谨慎确认！</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="confirmDeleteBtn" class="btn sci-fi-btn danger-btn confirm-delete-btn">
                        删除
                    </button>
                    <button class="btn sci-fi-btn secondary" onclick="closeDeleteConfirm()">取消</button>
                </div>
            </div>
        </div>
    </div>



    <!-- 背景详情模态框 -->
    <div id="backgroundDetailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>背景详情</h3>
                <button class="close-btn" onclick="closeBackgroundDetail()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="character-detail">
                    <img id="detailBackgroundImage" class="character-avatar" src="" alt="背景图片"
                        style="width: 400px; height: 240px; object-fit: cover;">
                    <div class="character-profile">
                        <div class="profile-item">
                            <div class="profile-label">背景名称</div>
                            <div id="detailBackgroundName" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">文件名</div>
                            <div id="detailBackgroundFilename" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">背景描述</div>
                            <div id="detailBackgroundDesc" class="profile-value"></div>
                        </div>
                        <div class="profile-item">
                            <div class="profile-label">提示词</div>
                            <div id="detailBackgroundPrompt" class="profile-value"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- 添加背景模态框 -->
    <div id="addBackgroundModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加背景</h3>
                <button class="close-btn" onclick="closeAddBackgroundModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addBackgroundForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="backgroundNameInput">背景名称 *</label>
                        <input type="text" id="backgroundNameInput" class="sci-fi-input" required placeholder="请输入背景名称">
                    </div>

                    <div class="form-group">
                        <label for="backgroundDescInput">背景描述</label>
                        <textarea id="backgroundDescInput" class="sci-fi-input" placeholder="背景的简介描述" rows="3"
                            style="width: 100%; min-height: 80px;"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="backgroundPromptInput">提示词</label>
                        <textarea id="backgroundPromptInput" class="sci-fi-input" placeholder="客观地描述这张图片" rows="4"
                            style="width: 100%; min-height: 100px;"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="backgroundFileInput">背景图片</label>
                        <div class="form-description">上传背景图片文件（支持 JPG、PNG、GIF、WebP）。如果上传图片，则使用AI生成</div>
                        <input type="file" id="backgroundFileInput" class="sci-fi-input form-file"
                            accept=".jpg,.jpeg,.png,.gif,.webp">
                    </div>

                    <div class="modal-actions">
                        <button type="submit" id="confirmAddBackgroundBtn" class="btn sci-fi-btn primary">添加背景</button>
                        <button type="button" class="btn sci-fi-btn secondary"
                            onclick="closeAddBackgroundModal()">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 删除背景确认模态框 -->
    <div id="deleteBackgroundConfirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header danger-header">
                <h3>删除背景确认</h3>
                <button class="close-btn" onclick="closeDeleteBackgroundConfirm()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <p>确定要删除这个背景吗？</p>
                    <p><strong class="danger-text">此操作不可恢复！</strong></p>
                </div>
                <div class="delete-target-info">
                    <p>背景名称: <strong id="deleteBackgroundName"></strong></p>
                    <p>文件名: <strong id="deleteBackgroundFilename"></strong></p>
                </div>
                <div class="modal-actions">
                    <button id="confirmDeleteBackgroundBtn" class="btn sci-fi-btn danger-btn">确认删除</button>
                    <button class="btn sci-fi-btn secondary" onclick="closeDeleteBackgroundConfirm()">取消</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/resource-management.js"></script>
    <script>
        // 设置当前页面
        window.addEventListener('DOMContentLoaded', function () {
            // 初始化TTS设置
            window.ttsEnabled = localStorage.getItem('ttsEnabled') !== 'false';
            window.ttsVolume = parseFloat(localStorage.getItem('ttsVolume') || '80') / 100;

            if (window.bgmService) {
                window.bgmService.setCurrentPage('resource_management');
            }
        });
    </script>
    <script src="/static/js/logo.js"></script>
    <script src="/static/js/sci-fi-effects.js"></script>
    <script type="module" src="/static/js/bgm-service.js"></script>
</body>

</html>